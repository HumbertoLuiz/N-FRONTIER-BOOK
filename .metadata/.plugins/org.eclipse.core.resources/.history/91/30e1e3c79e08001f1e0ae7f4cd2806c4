package com.nofrontier.book.core.validators;

import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.stereotype.Component;
import org.springframework.validation.FieldError;

import com.nofrontier.book.domain.exceptions.UserAlreadyRegisteredException;
import com.nofrontier.book.domain.model.User;
import com.nofrontier.book.domain.repository.UserRepository;

@Component
public class UserValidator {

	@Autowired
	private UserRepository repository;

	public void validate(User user) {
		validateUsername(user);
	}

	private void validateUsername(User user) {
		if (repository.isUsernameAlreadyRegistered(user)) {
			var message = "User Registered Already exists with this username";
			var fieldError = new FieldError(user.getClass().getName(), "email", user.getUsername(), false, null, null, message);
			throw new UserAlreadyRegisteredException(message, fieldError);
		}
	}
}
